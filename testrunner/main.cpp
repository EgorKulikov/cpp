#include "C:/Users/kulikov/proj/cpp/tasks/mincostflow.cpp"

#include <iostream>
#include <fstream>
#include <sstream>
#include <string>
#include <vector>
#include <cctype>
#include <ctime>

namespace jhelper {

struct Test {
	std::string input;
	std::string output;
	bool active;
	bool has_output;
};

bool check(std::string expected, std::string actual) {
	while(!expected.empty() && isspace(*--expected.end()))
		expected.erase(--expected.end());
	while(!actual.empty() && isspace(*--actual.end()))
		actual.erase(--actual.end());
	return expected == actual;
}

} // namespace jhelper

int main() {
	std::vector<jhelper::Test> tests = {
		{"42 421\n1 2 1 0\n1 3 3 0\n1 4 5 0\n1 5 10 0\n1 6 20 0\n1 7 40 0\n1 8 80 0\n1 9 160 0\n1 10 320 0\n1 11 640 0\n1 12 1280 0\n1 13 2560 0\n1 14 5120 0\n1 15 10240 0\n1 16 20480 0\n1 17 40960 0\n1 18 81920 0\n1 19 163840 0\n1 20 327680 0\n1 21 655360 0\n2 22 5242880 0\n2 23 5242880 1\n2 24 5242880 3\n2 25 5242880 7\n2 26 5242880 15\n2 27 5242880 31\n2 28 5242880 63\n2 29 5242880 127\n2 30 5242880 255\n2 31 5242880 511\n2 32 5242880 1023\n2 33 5242880 2047\n2 34 5242880 4095\n2 35 5242880 8191\n2 36 5242880 16383\n2 37 5242880 32767\n2 38 5242880 65535\n2 39 5242880 131071\n2 40 5242880 262143\n2 41 5242880 524287\n3 22 5242880 1\n3 24 5242880 3\n3 25 5242880 7\n3 26 5242880 15\n3 27 5242880 31\n3 28 5242880 63\n3 29 5242880 127\n3 30 5242880 255\n3 31 5242880 511\n3 32 5242880 1023\n3 33 5242880 2047\n3 34 5242880 4095\n3 35 5242880 8191\n3 36 5242880 16383\n3 37 5242880 32767\n3 38 5242880 65535\n3 39 5242880 131071\n3 40 5242880 262143\n3 41 5242880 524287\n4 22 5242880 3\n4 23 5242880 3\n4 25 5242880 7\n4 26 5242880 15\n4 27 5242880 31\n4 28 5242880 63\n4 29 5242880 127\n4 30 5242880 255\n4 31 5242880 511\n4 32 5242880 1023\n4 33 5242880 2047\n4 34 5242880 4095\n4 35 5242880 8191\n4 36 5242880 16383\n4 37 5242880 32767\n4 38 5242880 65535\n4 39 5242880 131071\n4 40 5242880 262143\n4 41 5242880 524287\n5 22 5242880 7\n5 23 5242880 7\n5 24 5242880 7\n5 26 5242880 15\n5 27 5242880 31\n5 28 5242880 63\n5 29 5242880 127\n5 30 5242880 255\n5 31 5242880 511\n5 32 5242880 1023\n5 33 5242880 2047\n5 34 5242880 4095\n5 35 5242880 8191\n5 36 5242880 16383\n5 37 5242880 32767\n5 38 5242880 65535\n5 39 5242880 131071\n5 40 5242880 262143\n5 41 5242880 524287\n6 22 5242880 15\n6 23 5242880 15\n6 24 5242880 15\n6 25 5242880 15\n6 27 5242880 31\n6 28 5242880 63\n6 29 5242880 127\n6 30 5242880 255\n6 31 5242880 511\n6 32 5242880 1023\n6 33 5242880 2047\n6 34 5242880 4095\n6 35 5242880 8191\n6 36 5242880 16383\n6 37 5242880 32767\n6 38 5242880 65535\n6 39 5242880 131071\n6 40 5242880 262143\n6 41 5242880 524287\n7 22 5242880 31\n7 23 5242880 31\n7 24 5242880 31\n7 25 5242880 31\n7 26 5242880 31\n7 28 5242880 63\n7 29 5242880 127\n7 30 5242880 255\n7 31 5242880 511\n7 32 5242880 1023\n7 33 5242880 2047\n7 34 5242880 4095\n7 35 5242880 8191\n7 36 5242880 16383\n7 37 5242880 32767\n7 38 5242880 65535\n7 39 5242880 131071\n7 40 5242880 262143\n7 41 5242880 524287\n8 22 5242880 63\n8 23 5242880 63\n8 24 5242880 63\n8 25 5242880 63\n8 26 5242880 63\n8 27 5242880 63\n8 29 5242880 127\n8 30 5242880 255\n8 31 5242880 511\n8 32 5242880 1023\n8 33 5242880 2047\n8 34 5242880 4095\n8 35 5242880 8191\n8 36 5242880 16383\n8 37 5242880 32767\n8 38 5242880 65535\n8 39 5242880 131071\n8 40 5242880 262143\n8 41 5242880 524287\n9 22 5242880 127\n9 23 5242880 127\n9 24 5242880 127\n9 25 5242880 127\n9 26 5242880 127\n9 27 5242880 127\n9 28 5242880 127\n9 30 5242880 255\n9 31 5242880 511\n9 32 5242880 1023\n9 33 5242880 2047\n9 34 5242880 4095\n9 35 5242880 8191\n9 36 5242880 16383\n9 37 5242880 32767\n9 38 5242880 65535\n9 39 5242880 131071\n9 40 5242880 262143\n9 41 5242880 524287\n10 22 5242880 255\n10 23 5242880 255\n10 24 5242880 255\n10 25 5242880 255\n10 26 5242880 255\n10 27 5242880 255\n10 28 5242880 255\n10 29 5242880 255\n10 31 5242880 511\n10 32 5242880 1023\n10 33 5242880 2047\n10 34 5242880 4095\n10 35 5242880 8191\n10 36 5242880 16383\n10 37 5242880 32767\n10 38 5242880 65535\n10 39 5242880 131071\n10 40 5242880 262143\n10 41 5242880 524287\n11 22 5242880 511\n11 23 5242880 511\n11 24 5242880 511\n11 25 5242880 511\n11 26 5242880 511\n11 27 5242880 511\n11 28 5242880 511\n11 29 5242880 511\n11 30 5242880 511\n11 32 5242880 1023\n11 33 5242880 2047\n11 34 5242880 4095\n11 35 5242880 8191\n11 36 5242880 16383\n11 37 5242880 32767\n11 38 5242880 65535\n11 39 5242880 131071\n11 40 5242880 262143\n11 41 5242880 524287\n12 22 5242880 1023\n12 23 5242880 1023\n12 24 5242880 1023\n12 25 5242880 1023\n12 26 5242880 1023\n12 27 5242880 1023\n12 28 5242880 1023\n12 29 5242880 1023\n12 30 5242880 1023\n12 31 5242880 1023\n12 33 5242880 2047\n12 34 5242880 4095\n12 35 5242880 8191\n12 36 5242880 16383\n12 37 5242880 32767\n12 38 5242880 65535\n12 39 5242880 131071\n12 40 5242880 262143\n12 41 5242880 524287\n13 22 5242880 2047\n13 23 5242880 2047\n13 24 5242880 2047\n13 25 5242880 2047\n13 26 5242880 2047\n13 27 5242880 2047\n13 28 5242880 2047\n13 29 5242880 2047\n13 30 5242880 2047\n13 31 5242880 2047\n13 32 5242880 2047\n13 34 5242880 4095\n13 35 5242880 8191\n13 36 5242880 16383\n13 37 5242880 32767\n13 38 5242880 65535\n13 39 5242880 131071\n13 40 5242880 262143\n13 41 5242880 524287\n14 22 5242880 4095\n14 23 5242880 4095\n14 24 5242880 4095\n14 25 5242880 4095\n14 26 5242880 4095\n14 27 5242880 4095\n14 28 5242880 4095\n14 29 5242880 4095\n14 30 5242880 4095\n14 31 5242880 4095\n14 32 5242880 4095\n14 33 5242880 4095\n14 35 5242880 8191\n14 36 5242880 16383\n14 37 5242880 32767\n14 38 5242880 65535\n14 39 5242880 131071\n14 40 5242880 262143\n14 41 5242880 524287\n15 22 5242880 8191\n15 23 5242880 8191\n15 24 5242880 8191\n15 25 5242880 8191\n15 26 5242880 8191\n15 27 5242880 8191\n15 28 5242880 8191\n15 29 5242880 8191\n15 30 5242880 8191\n15 31 5242880 8191\n15 32 5242880 8191\n15 33 5242880 8191\n15 34 5242880 8191\n15 36 5242880 16383\n15 37 5242880 32767\n15 38 5242880 65535\n15 39 5242880 131071\n15 40 5242880 262143\n15 41 5242880 524287\n16 22 5242880 16383\n16 23 5242880 16383\n16 24 5242880 16383\n16 25 5242880 16383\n16 26 5242880 16383\n16 27 5242880 16383\n16 28 5242880 16383\n16 29 5242880 16383\n16 30 5242880 16383\n16 31 5242880 16383\n16 32 5242880 16383\n16 33 5242880 16383\n16 34 5242880 16383\n16 35 5242880 16383\n16 37 5242880 32767\n16 38 5242880 65535\n16 39 5242880 131071\n16 40 5242880 262143\n16 41 5242880 524287\n17 22 5242880 32767\n17 23 5242880 32767\n17 24 5242880 32767\n17 25 5242880 32767\n17 26 5242880 32767\n17 27 5242880 32767\n17 28 5242880 32767\n17 29 5242880 32767\n17 30 5242880 32767\n17 31 5242880 32767\n17 32 5242880 32767\n17 33 5242880 32767\n17 34 5242880 32767\n17 35 5242880 32767\n17 36 5242880 32767\n17 38 5242880 65535\n17 39 5242880 131071\n17 40 5242880 262143\n17 41 5242880 524287\n18 22 5242880 65535\n18 23 5242880 65535\n18 24 5242880 65535\n18 25 5242880 65535\n18 26 5242880 65535\n18 27 5242880 65535\n18 28 5242880 65535\n18 29 5242880 65535\n18 30 5242880 65535\n18 31 5242880 65535\n18 32 5242880 65535\n18 33 5242880 65535\n18 34 5242880 65535\n18 35 5242880 65535\n18 36 5242880 65535\n18 37 5242880 65535\n18 39 5242880 131071\n18 40 5242880 262143\n18 41 5242880 524287\n19 22 5242880 131071\n19 23 5242880 131071\n19 24 5242880 131071\n19 25 5242880 131071\n19 26 5242880 131071\n19 27 5242880 131071\n19 28 5242880 131071\n19 29 5242880 131071\n19 30 5242880 131071\n19 31 5242880 131071\n19 32 5242880 131071\n19 33 5242880 131071\n19 34 5242880 131071\n19 35 5242880 131071\n19 36 5242880 131071\n19 37 5242880 131071\n19 38 5242880 131071\n19 40 5242880 262143\n19 41 5242880 524287\n20 22 5242880 262143\n20 23 5242880 262143\n20 24 5242880 262143\n20 25 5242880 262143\n20 26 5242880 262143\n20 27 5242880 262143\n20 28 5242880 262143\n20 29 5242880 262143\n20 30 5242880 262143\n20 31 5242880 262143\n20 32 5242880 262143\n20 33 5242880 262143\n20 34 5242880 262143\n20 35 5242880 262143\n20 36 5242880 262143\n20 37 5242880 262143\n20 38 5242880 262143\n20 39 5242880 262143\n20 41 5242880 524287\n21 22 5242880 524287\n21 23 5242880 524287\n21 24 5242880 524287\n21 25 5242880 524287\n21 26 5242880 524287\n21 27 5242880 524287\n21 28 5242880 524287\n21 29 5242880 524287\n21 30 5242880 524287\n21 31 5242880 524287\n21 32 5242880 524287\n21 33 5242880 524287\n21 34 5242880 524287\n21 35 5242880 524287\n21 36 5242880 524287\n21 37 5242880 524287\n21 38 5242880 524287\n21 39 5242880 524287\n21 40 5242880 524287\n22 42 2 0\n23 42 2 0\n24 42 5 0\n25 42 10 0\n26 42 20 0\n27 42 40 0\n28 42 80 0\n29 42 160 0\n30 42 320 0\n31 42 640 0\n32 42 1280 0\n33 42 2560 0\n34 42 5120 0\n35 42 10240 0\n36 42 20480 0\n37 42 40960 0\n38 42 81920 0\n39 42 163840 0\n40 42 327680 0\n41 42 655360 0", "", true, false},{"8 23\n2 3 2147483647 1\n1 3 1 1\n2 4 2147483647 2\n1 4 1 2\n2 8 2 0\n3 5 2147483647 3\n1 5 1 3\n3 6 2147483647 4\n1 6 1 4\n3 8 2 0\n3 2 2147483647 0\n4 6 2147483647 5\n1 6 1 5\n4 7 2147483647 6\n1 7 1 6\n4 8 2 0\n4 2 2147483647 0\n5 8 0 0\n5 2 2147483647 0\n6 8 0 0\n6 2 2147483647 0\n7 8 0 0\n7 2 2147483647 0", "6 24", true, true},{"2 1\n1 2 1 1\n", "1 1\n", true, true},
	};
	bool allOK = true;
	int testID = 0;
	std::cout << std::fixed;
	double maxTime = 0.0;
	for(const jhelper::Test& test: tests ) {
		std::cout << "Test #" << ++testID << std::endl;
		std::cout << "Input: \n" << test.input << std::endl;
		if (test.has_output) {
			std::cout << "Expected output: \n" << test.output << std::endl;
		}
		else {
			std::cout << "Expected output: \n" << "N/A" << std::endl;
		}
		if (test.active) {
			std::stringstream in(test.input);
			std::ostringstream out;
			std::clock_t start = std::clock();
			try {
			    mincostflow solver;
			    solver.solve(in, out);
            } catch (const char* e) {
                std::cerr << e << std::endl;
            }
			std::clock_t finish = std::clock();
			double currentTime = double(finish - start) / CLOCKS_PER_SEC;
			maxTime = std::max(currentTime, maxTime);
			std::cout << "Actual output: \n" << out.str() << std::endl;
			if (test.has_output) {
				bool result = jhelper::check(test.output, out.str());
				allOK = allOK && result;
				std::cout << "Result: " << (result ? "OK" : "Wrong answer") << std::endl;
			}
			std::cout << "Time: " << currentTime << std::endl;
		}
		else {
			std::cout << "SKIPPED\n";
		}

		std::cout << std::endl;

	}
	if(allOK) {
		std::cout << "All OK" << std::endl;
	}
	else {
		std::cout << "Some cases failed" << std::endl;
	}
	std::cout << "Maximal time: " << maxTime << "s." << std::endl;
	return 0;
}
